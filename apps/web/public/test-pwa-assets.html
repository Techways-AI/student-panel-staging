<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Assets Test Page</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        h2 {
            color: #666;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #F6F1E8;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success {
            background: #4CAF50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .status.loading {
            background: #ff9800;
            color: white;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .icon-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            background: #fafafa;
        }
        .icon-item img {
            max-width: 100%;
            height: auto;
            border: 1px solid #eee;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .icon-item .name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .icon-item .size {
            font-size: 12px;
            color: #666;
        }
        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-box strong {
            color: #1976D2;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .manifest-info {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        button {
            background: #F6F1E8;
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background: #e8e0d0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PWA Assets Test Page <span class="status loading" id="overall-status">Testing...</span></h1>
        <p>This page tests all PWA assets to ensure they're properly configured and accessible.</p>

        <div class="info-box">
            <strong>üí° Tip:</strong> Open this page at <code>https://student-panel-staging-production-d927.up.railway.app/test-pwa-assets.html</code> 
            to verify all PWA assets are loading correctly.
        </div>

        <h2>üì± Manifest.json</h2>
        <div id="manifest-status"></div>
        <div class="manifest-info" id="manifest-content">Loading...</div>

        <h2>üé® Icons</h2>
        <div class="icon-grid" id="icons-grid"></div>

        <h2>üçé iOS Splash Screens (Sample)</h2>
        <div class="icon-grid" id="splash-grid"></div>

        <h2>ü™ü Windows MSTiles</h2>
        <div class="icon-grid" id="mstile-grid"></div>

        <button onclick="testAllAssets()">üîÑ Re-test All Assets</button>
    </div>

    <script>
        const assets = {
            icons: [
                { name: 'Manifest Icon 192x192', path: '/assets/pwa/manifest-icon-192.maskable.png', size: '192x192' },
                { name: 'Manifest Icon 512x512', path: '/assets/pwa/manifest-icon-512.maskable.png', size: '512x512' },
                { name: 'Apple Touch Icon', path: '/assets/pwa/apple-icon-180.png', size: '180x180' },
                { name: 'Favicon', path: '/assets/pwa/favicon-196.png', size: '196x196' }
            ],
            splash: [
                { name: 'iPhone 14 Pro', path: '/assets/pwa/apple-splash-1179-2556.png', size: '1179x2556' },
                { name: 'iPhone 13/14', path: '/assets/pwa/apple-splash-1170-2532.png', size: '1170x2532' },
                { name: 'iPhone 12/13 Pro', path: '/assets/pwa/apple-splash-1125-2436.png', size: '1125x2436' },
                { name: 'iPad Pro 12.9"', path: '/assets/pwa/apple-splash-2048-2732.png', size: '2048x2732' }
            ],
            mstiles: [
                { name: 'MSTile 70x70', path: '/assets/pwa/mstile-icon-128.png', size: '128x128' },
                { name: 'MSTile 150x150', path: '/assets/pwa/mstile-icon-270.png', size: '270x270' },
                { name: 'MSTile 310x310', path: '/assets/pwa/mstile-icon-558.png', size: '558x558' },
                { name: 'MSTile Wide', path: '/assets/pwa/mstile-icon-558-270.png', size: '558x270' }
            ]
        };

        function testImage(path) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve({ success: true, path });
                img.onerror = () => resolve({ success: false, path });
                img.src = path;
            });
        }

        function createIconItem(item, type) {
            const div = document.createElement('div');
            div.className = 'icon-item';
            
            const img = document.createElement('img');
            img.src = item.path;
            img.alt = item.name;
            img.onload = () => {
                div.querySelector('.status').textContent = '‚úì Loaded';
                div.querySelector('.status').className = 'status success';
            };
            img.onerror = () => {
                div.querySelector('.status').textContent = '‚úó Failed';
                div.querySelector('.status').className = 'status error';
                div.querySelector('.error-message').textContent = `404: ${item.path}`;
            };

            div.innerHTML = `
                ${img.outerHTML}
                <div class="name">${item.name}</div>
                <div class="size">${item.size}</div>
                <div class="status loading">Loading...</div>
                <div class="error-message"></div>
            `;

            return div;
        }

        async function testManifest() {
            try {
                const response = await fetch('/manifest.json');
                if (!response.ok) throw new Error('Manifest not found');
                
                const manifest = await response.json();
                const statusDiv = document.getElementById('manifest-status');
                const contentDiv = document.getElementById('manifest-content');

                // Check background color
                const bgColor = manifest.background_color || 'Not set';
                const themeColor = manifest.theme_color || 'Not set';
                
                statusDiv.innerHTML = '<span class="status success">‚úì Manifest.json loaded successfully</span>';
                statusDiv.innerHTML += `<div style="margin-top: 10px;"><strong>Background Color:</strong> <span style="display: inline-block; width: 20px; height: 20px; background: ${bgColor}; border: 1px solid #ddd; vertical-align: middle; margin-left: 5px;"></span> <code>${bgColor}</code></div>`;
                statusDiv.innerHTML += `<div style="margin-top: 5px;"><strong>Theme Color:</strong> <span style="display: inline-block; width: 20px; height: 20px; background: ${themeColor}; border: 1px solid #ddd; vertical-align: middle; margin-left: 5px;"></span> <code>${themeColor}</code></div>`;
                
                contentDiv.textContent = JSON.stringify(manifest, null, 2);

                // Test icon paths - normalize paths (add leading slash if missing)
                let iconErrors = [];
                if (manifest.icons) {
                    for (const icon of manifest.icons) {
                        // Normalize path: add leading slash if it doesn't start with http or /
                        let testPath = icon.src;
                        if (!testPath.startsWith('http') && !testPath.startsWith('/')) {
                            testPath = '/' + testPath;
                        }
                        const result = await testImage(testPath);
                        if (!result.success) {
                            iconErrors.push(icon.src);
                        }
                    }
                }

                if (iconErrors.length > 0) {
                    statusDiv.innerHTML += `<div class="error-message" style="margin-top: 10px;">‚ö†Ô∏è Some icons in manifest failed to load: ${iconErrors.join(', ')}</div>`;
                } else if (manifest.icons && manifest.icons.length > 0) {
                    statusDiv.innerHTML += '<div style="margin-top: 10px; color: #4CAF50;">‚úì All manifest icons are accessible</div>';
                }

            } catch (error) {
                document.getElementById('manifest-status').innerHTML = 
                    `<span class="status error">‚úó Failed to load manifest.json: ${error.message}</span>`;
                document.getElementById('manifest-content').textContent = 'Error: ' + error.message;
            }
        }

        function renderIcons() {
            const iconsGrid = document.getElementById('icons-grid');
            iconsGrid.innerHTML = '';
            assets.icons.forEach(item => {
                iconsGrid.appendChild(createIconItem(item, 'icon'));
            });
        }

        function renderSplash() {
            const splashGrid = document.getElementById('splash-grid');
            splashGrid.innerHTML = '';
            assets.splash.forEach(item => {
                splashGrid.appendChild(createIconItem(item, 'splash'));
            });
        }

        function renderMSTiles() {
            const mstileGrid = document.getElementById('mstile-grid');
            mstileGrid.innerHTML = '';
            assets.mstiles.forEach(item => {
                mstileGrid.appendChild(createIconItem(item, 'mstile'));
            });
        }

        async function testAllAssets() {
            document.getElementById('overall-status').textContent = 'Testing...';
            document.getElementById('overall-status').className = 'status loading';

            await testManifest();
            renderIcons();
            renderSplash();
            renderMSTiles();

            // Wait a bit for images to load, then update overall status
            setTimeout(() => {
                const errors = document.querySelectorAll('.status.error').length;
                if (errors === 0) {
                    document.getElementById('overall-status').textContent = 'All Tests Passed ‚úì';
                    document.getElementById('overall-status').className = 'status success';
                } else {
                    document.getElementById('overall-status').textContent = `${errors} Error(s) Found`;
                    document.getElementById('overall-status').className = 'status error';
                }
            }, 2000);
        }

        // Run tests on page load
        testAllAssets();
    </script>
</body>
</html>


