// PDF.js Worker Implementation
// This is a simplified worker that handles basic PDF operations

let pdfDocument = null;

self.onmessage = function(e) {
  const { cmd, data } = e.data;
  
  try {
    switch (cmd) {
      case 'GetDocument':
        // Simulate document loading
        pdfDocument = {
          numPages: 1,
          getPage: function(pageNum) {
            return {
              getTextContent: function() {
                return Promise.resolve({
                  items: [
                    { str: 'PDF Document Content' },
                    { str: 'This is a simplified PDF viewer.' },
                    { str: 'For full functionality, please download the document.' }
                  ]
                });
              }
            };
          }
        };
        
        self.postMessage({
          cmd: 'GetDocument',
          data: {
            numPages: pdfDocument.numPages,
            fingerprint: 'simplified-worker'
          }
        });
        break;
        
      case 'GetPage':
        if (pdfDocument) {
          const page = pdfDocument.getPage(data.pageIndex);
          self.postMessage({
            cmd: 'GetPage',
            data: { page }
          });
        }
        break;
        
      case 'GetTextContent':
        if (pdfDocument) {
          const page = pdfDocument.getPage(data.pageIndex);
          page.getTextContent().then(textContent => {
            self.postMessage({
              cmd: 'GetTextContent',
              data: { textContent }
            });
          });
        }
        break;
        
      default:
        self.postMessage({
          cmd: 'Error',
          data: { message: `Unknown command: ${cmd}` }
        });
    }
  } catch (error) {
    self.postMessage({
      cmd: 'Error',
      data: { message: error.message }
    });
  }
};

// Signal that worker is ready
self.postMessage({ cmd: 'Ready' }); 